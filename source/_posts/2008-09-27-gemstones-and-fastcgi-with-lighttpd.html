---
layout: post
title: Gemstone/S and FastCGI with lighttpd
categories: []
tags:
- Uncategorized
status: publish
type: post
published: true
meta:
  _edit_last: '2'
---
I was reading the <a href="http://programminggems.wordpress.com/2008/09/12/slice-4/">post</a> from James Foster about configuring Apache/FastCGI for serving Seaside. I prefer Lighttpd because, as its name implies, it needs less resources to run. And with virtual hosting, as I have my servers, memory it is a big factor. <br /><br />I followed the <a href="http://programminggems.wordpress.com/2008/09/05/setting-up-glass-on-slicehost/">steps</a> to install Gemstone/S in my machine. Instead of a hosted server, I used my laptop with my user as server.<br />After testing that Seaside was running OK in my machine, using:<br /><br />miguel@laptop:~$ source /opt/gemstone/product/seaside/defSeaside<br />miguel@laptop:~$ startGemstone<br />miguel@laptop:~$ startSeaside_Hyper 8080<br /><br />and navigating to:<br /><br />http://localhost:8080/seaside<br /><br />I stoped the Hyper Webserver with Ctrl+C.<br /><br />Now to install lighttpd in my Debian GNU/Linux 4.0 etch machine. As root:<br /><br />laptop:~# aptitude install lighttpd lighttpd-doc<br /><br />and backup the default config file:<br /><br />laptop:~# cp /etc/lighttpd/lighttpd.conf /etc/lighttpd/lighttpd.conf.bak<br /><br />then use this configuration for lighttpd.conf:<br /><br /># Modules activated<br />server.modules = ( "mod_access", "mod_alias", "mod_accesslog", "mod_fastcgi" )<br /># Document root, maybe there you have other sites also<br />server.document-root = "/var/www/"<br /># logs<br />server.errorlog = "/var/log/lighttpd/error.log"<br />accesslog.filename = "/var/log/lighttpd/access.log"<br /># Welcome file<br />index-file.names = ( "index.html" )<br /># Do not server files beginning with<br />url.access-deny = ( "~", ".inc" )<br /># Server config<br />server.port = 80<br />server.pid-file = "/var/run/lighttpd.pid"<br />dir-listing.encoding = "utf-8"<br />server.dir-listing = "disable"<br />server.username = "www-data"<br />server.groupname = "www-data"<br /># FastCGI<br /># Debug enabled, disable on production sites<br />fastcgi.debug = 1<br /># Do FastCGI for anything with prefix /seaside<br /># load-balancing with 3 hosts<br /># check-local disable searching the requested file in the lighttpd document root and<br /># forward the request to the fastcgi hosts<br />fastcgi.server = ( "/seaside" =&gt; (<br />&nbsp;&nbsp;&nbsp; ( "host" =&gt; "127.0.0.1", "port" =&gt; 9001, "check-local" =&gt; "disable"),<br />&nbsp;&nbsp;&nbsp; ( "host" =&gt; "127.0.0.1", "port" =&gt; 9002, "check-local" =&gt; "disable"),<br />&nbsp;&nbsp;&nbsp; ( "host" =&gt; "127.0.0.1", "port" =&gt; 9003, "check-local" =&gt; "disable")<br />&nbsp; )<br />)<br /><br />Instead of starting Seaside over Gemstone/S with startSeaside_Hyper &lt;port&gt;, I used the provided script to start 3 gems for fastcgi as per James' <a href="http://programminggems.wordpress.com/2008/09/12/slice-4/">instructions</a>:<br /><br />miguel@laptop:~$ runSeasideGems start<br /><br />This started 3 fastcgi gems, listening in ports 9001, 9002 and 9003.<br /><br />Then I restarted lighttpd:<br /><br />laptop:~# /etc/init.d/lighttpd restart<br />Stopping web server: lighttpd.<br />Starting web server: lighttpd.<br /><br />And tested that the default index page for lighttpd (located in /var/www/index.html) was served statically (you can add anything here)&nbsp; from the server document root (/var/www/), pointing the browser to:<br /><br />http://localhost/<br /><br />Finally, I tested that the /seaside part was correctly delegated to Gemstone/S using FastCGI, pointing the browser to:<br /><br />http://localhost/seaside<br /><br />This time I get the dispatcher from Seaside, from where you can navigate the links from Seaside without problems.<br /><br />This way you can use, for example, <a href="http://http//www.blueprintcss.org/">blueprint</a> for the CSS style of your app, or maybe <a href="http://tinymce.moxiecode.com/">TinyMCE,</a> for having a full fledged text editor. All you have to do is to put them in a directory inside the document root of lighttpd (/var/www in this example) and in the Seaside application, you reference them with the absolut path to your website, for example:<br /><br />http://mysite.com/styles/blueprint.css<br /><br />or<br /><br />http://mysite.com/tinymce/jscripts/tiny_mce/tiny_mce.js<br /><br />So, the webserver to serve the static content of your site (faster) and Seaside to serve your webapp.<br /><br />Enjoy.<br /><br /><br /><br /><br />
